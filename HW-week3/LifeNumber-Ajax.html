<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">
  <!--<link rel="icon" href="../../favicon.ico">-->

  <title>生命靈數-Ajax</title>



  <!-- Bootstrap core CSS -->
  <link href="stylesheets/bootstrap.min.css" rel="stylesheet">

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <!--<link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">-->

  <!-- Custom styles for this template -->
  <link href="stylesheets/dashboard.css" rel="stylesheet">

  <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
  <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
  <!--<script src="../../assets/js/ie-emulation-modes-warning.js"></script>-->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->




</head>

<body>

  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
          aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Project name</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#">Dashboard</a></li>
          <li><a href="#">Settings</a></li>
          <li><a href="#">Profile</a></li>
          <li><a href="#">Help</a></li>
        </ul>
        <form class="navbar-form navbar-right">
          <input type="text" class="form-control" placeholder="Search...">
        </form>
      </div>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-3 col-md-2 sidebar">
        <ul class="nav nav-sidebar">
          <li class="active"><a href="#">Overview <span class="sr-only">(current)</span></a></li>
          <li><a href="#">Reports</a></li>
          <li><a href="#">Analytics</a></li>
          <li><a href="#">Export</a></li>
        </ul>
        <ul class="nav nav-sidebar">
          <li><a href="">Nav item</a></li>
          <li><a href="">Nav item again</a></li>
          <li><a href="">One more nav</a></li>
          <li><a href="">Another nav item</a></li>
          <li><a href="">More navigation</a></li>
        </ul>
        <ul class="nav nav-sidebar">
          <li><a href="">Nav item again</a></li>
          <li><a href="">One more nav</a></li>
          <li><a href="">Another nav item</a></li>
        </ul>
      </div>

      <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-12">
              <h2>生命靈數-Ajax</h2>

              <!-- class="input-group":將文字框和button 放在同一列  -->
              <div class="input-group">
                <input type="date" id="date" class="form-control" value="2019-10-18" required>
                <span class="input-group-btn">
                  <button id="BtnResult" class="btn btn-primary">分析結果</button>
                  <!-- <a id="guess" type="button" class="btn btn-default">分析結果</a> -->
                </span>
              </div>

              <!-- jquery 控制顯示/關閉 -->
              <div class="list-group-item" id="divresult">
                <!-- class="close" 關閉按鈕即跑到右上角 -->
                <button class="close" id="BtnClose">&times;</button>
                <span class="border border-secondary" style="font-size: 20px;"><span id="datetext" style="background-color: gold;"></span>出生的你，星座是 <span
                    id="constellation"></span>
                </span>
                <br />

                <span style="font-size: 20px;">您的生命靈數是: <span id="lifenumber"></span></span>
                <br />

                <span style="font-size: 20px;">結果: <span id="answertext"></span></span>
              </div>


            </div>
          </div>

          <!-- <div class="row list-group-item" id="divresult" >
            <div class="col-md-10">
              <span class="border border-secondary"><span id="datetext"></span>出生的你，星座是 <span id="constellation"></span>
              </span>
              <br />

              <span>您的生命靈數是: <span id="lifenumber"></span></span>
              <br />

              <span>結果: <span id="answertext"></span></span>
            </div>
            <div class="col-md-2">
              <button class="close" id="BtnClose">&times;</button>
            </div>
          </div> -->

        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!--<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>-->
  <!-- <script src="scripts/bootstrap.min.js"></script> -->
  <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
  <!--<script src="../../assets/js/vendor/holder.min.js"></script>-->
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <!--<script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>-->
  <script>
    // 取得 生命靈數
    function GetLifeNumber(Year, Month, Day) {
      let LifeNumber = 0;
      let lifenumber_year = 0;
      let lifenumber_month = 0;
      let lifenumber_day = 0;

      // 取 "年" 的生命靈數
      let divisor = 1000; // 除數
      let yearMod = Year; // 
      for (i = 1; i <= 4; i++) {

        Digits = parseInt(yearMod / divisor); // 取(千百十個)位數 的值
        yearMod = yearMod % divisor;
        divisor = divisor / 10;

        lifenumber_year += Digits;
      }

      // TenDigits:十位數 ， Digits:個位數
      // 取 "月" 的生命靈數
      if (Month > 0 && Month < 10) {
        lifenumber_month = parseInt(Month); // 轉為 "數字"
      } else {
        let TenDigits = parseInt(Month / 10);
        let Digits = Month % 10;
        lifenumber_month = TenDigits + Digits;
      }


      // 取 "日" 的生命靈數
      if (Day > 0 && Day < 10) {
        lifenumber_day = parseInt(Day);
      } else {
        let TenDigits = parseInt(Day / 10);
        let Digits = Day % 10;
        lifenumber_day = TenDigits + Digits;
      }
      LifeNumber = lifenumber_year + lifenumber_month + lifenumber_day;

      console.log("生命靈數(年):" + lifenumber_year);
      console.log("生命靈數(月):" + lifenumber_month);
      console.log("生命靈數(日):" + lifenumber_day);
      console.log("生命靈數(未加):" + LifeNumber);

      while (true) {
        if (LifeNumber > 0 && LifeNumber < 10) {
          return LifeNumber;
          break;
        } else {
          let TenDigits = parseInt(LifeNumber / 10);
          let Digits = LifeNumber % 10;
          LifeNumber = TenDigits + Digits;
        }
      }

    };

    // 取得 星座
    function GetConstellation(month, day) {
      let Array_Constellation = [];
      if (month == 3 && day >= 21 || month == 4 && day <= 19) {
        Array_Constellation[0] = "牧羊座";
        Array_Constellation[1] = "aries";
        return Array_Constellation;
      } else if (month == 4 && day >= 20 || month == 5 && day <= 20) {
        Array_Constellation[0] = "金牛座";
        Array_Constellation[1] = "taurus";
        return Array_Constellation;
      } else if (month == 5 && day >= 21 || month == 6 && day <= 21) {
        Array_Constellation[0] = "雙子座";
        Array_Constellation[1] = "gemini";
        return Array_Constellation;
      } else if (month == 6 && day >= 22 || month == 7 && day <= 22) {
        Array_Constellation[0] = "巨蟹座";
        Array_Constellation[1] = "cancer";
        return Array_Constellation;
      } else if (month == 7 && day >= 23 || month == 8 && day <= 22) {
        Array_Constellation[0] = "獅子座";
        Array_Constellation[1] = "leo";
        return Array_Constellation;
      } else if (month == 8 && day >= 23 || month == 9 && day <= 22) {
        Array_Constellation[0] = "處女座";
        Array_Constellation[1] = "virgo";
        return Array_Constellation;
      } else if (month == 9 && day >= 23 || month == 10 && day <= 23) {
        Array_Constellation[0] = "天秤座";
        Array_Constellation[1] = "libra";
        return Array_Constellation;
      } else if (month == 10 && day >= 24 || month == 11 && day <= 22) {
        Array_Constellation[0] = "天蠍座";
        Array_Constellation[1] = "scorpio";
        return Array_Constellation;
      } else if (month == 11 && day >= 23 || month == 12 && day <= 21) {
        Array_Constellation[0] = "射手座";
        Array_Constellation[1] = "sagittarius";
        return Array_Constellation;
      } else if (month == 12 && day >= 22 || month == 1 && day <= 19) {
        Array_Constellation[0] = "摩羯座";
        Array_Constellation[1] = "capricorn";
        return Array_Constellation;
      } else if (month == 1 && day >= 20 || month == 2 && day <= 18) {
        Array_Constellation[0] = "水瓶座";
        Array_Constellation[1] = "aquarius";
        return Array_Constellation;
      } else if (month == 2 && day >= 19 || month == 3 && day <= 20) {
        Array_Constellation[0] = "雙魚座";
        Array_Constellation[1] = "pisces";
        return Array_Constellation;
      }

    }

    function GetAjax(Constellation, LifeNumber) {
      $.ajax({
        type: "Get",
        url: `https://buildschoolnumerology.azurewebsites.net/api/Number/Numerology?constellation=${Constellation}`,
        dataType: "json",
        success: function (answer) {
          console.log("ajax:" + answer)
          //呼叫遠端服務後的回傳結果
          $('#answertext').html(answer.lookup[LifeNumber - 1]); //因為陣列是從 0開始 
          // console.log("ajax:" + answer.name);

        }
      })
    }

    function BtnResult() {
      // 取得日期 (Ex. 2019-10-18)
      var Date1 = $("#date").val();
      console.log(Date1);
      // if(Date1 = null){
      //   alert("輸入錯誤");
      // }

      // 是陣列 [年,月,日]  (Ex. ["2019","10","18"])
      var YearMonthDay = Date1.split("-");
      let Year = YearMonthDay[0];
      let Month = YearMonthDay[1];
      let Day = YearMonthDay[2];

      // 取 星座 (Ex. Array_Constellation = [處女座, virgo])
      var Array_Constellation = GetConstellation(parseInt(Month), parseInt(Day));
      console.log(Array_Constellation);

      // 取 生命靈數
      var LifeNumber = GetLifeNumber(Year, Month, Day);
      console.log("生命靈數:" + LifeNumber);

      // 生命靈數的結果
      GetAjax(Array_Constellation[1], LifeNumber);

      // 顯示結果
      $("#datetext").html(Date1);
      $("#constellation").html(Array_Constellation[0]);
      $("#lifenumber").html(LifeNumber);
      // 顯示div (結果)
      $("#divresult").css("display", "block");

    }

    // 隱藏div (結果)
    function BtnClose() {
      $("#divresult").css("display", "none");
    }




    $(document).ready(function () {
      $("#BtnResult").click(BtnResult);

      // 隱藏div (結果)
      $("#BtnClose").click(BtnClose);
      $("#divresult").css("display", "none");
    });
  </script>
</body>

</html>